import org.apache.tools.ant.filters.ReplaceTokens

weberExec = null


task build_assets << {
    println "Building assets"
    project.exec{
        executable 'weber'
        args 'build'
    }
}


task build_web_app (dependsOn: build_assets) << {
    println "Copying web app assets"
    project.copy {
        from 'public'
        into 'gh-pages'
    }
}


task build_mobile_app (dependsOn: build_assets) << {
    println "Copying mobile app assets"
    project.copy {
        from 'public'
        into 'android/assets/www'
        exclude 'app.js'
        exclude 'app.css'
    }

    println "Setup Android specific stuff in index.html"
    [
        '<!-- cordova placeholder -->' : '<script type="text/javascript" charset="utf-8" src="cordova-1.5.0.js"></script>',
        'app.require' : 'app_android.require'
    ].each {
        ant.replace(
            file: 'android/assets/www/index.html',
            token: it.key,
            value: it.value
        )
    }
}

task build << {
    tasks.build_assets.execute()
    tasks.build_web_app.execute()
    tasks.build_mobile_app.execute()
}



defaultTasks 'build'
